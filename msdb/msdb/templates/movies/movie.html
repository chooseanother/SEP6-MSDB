{% extends "base.html" %}
{% load static i18n compress%}

<style>
  a {
    text-decoration: none !important;
  }
</style>

{% block content %}
<h1>{{ movie_datab.title }}</h1>
<p>{{ movie_datab.year }}&nbsp;&nbsp;&nbsp; - &nbsp;&nbsp;&nbsp; {{ movie_api.rated}} &nbsp;&nbsp;&nbsp; - &nbsp;&nbsp;&nbsp;{{ movie_api.runtime }}</p>
<div class="container bg-dark text-white p-4">
  <div class="row">
    <div class="col-sm-3">
      {% if movie_datab.poster_url %}
        <img src="{{ movie_datab.poster_url }}" alt="{{movie_datab.title}} poster" width="100%">
      {% else %}
        <img src="{% static 'images/document_missing.png' %}"  alt="{{movie_datab.title}} poster" width="100%">
      {% endif %}
    </div>
    <div class="col-md-5 col-sm-9">
      <p>Genre:
        {% for genre in movie_datab.genre %}
          <a href="#" class="badge bg-light text-dark">{{ genre }}</a>
        {% endfor %}
      </p>
      <p>Director:
        {% for director in movie_datab.director %}
          <a href="{% url 'person' director %}" class="badge bg-light text-dark">{{ director }}</a>
        {% endfor %}
      </p>
      <p>Actors:
        {% for actor in movie_datab.actors %}
          <a href="{% url 'person' actor %}" class="badge bg-light text-dark">{{ actor }}</a>
        {% endfor %}
      </p>
      <p>Released: {{ movie_api.released }}</p>
      <p>{{ movie_api.plot }}</p>
    </div>
    <div class="col-md-4 col-sm-12">
      <section style="float: right;">
        <a class="btn btn-outline-light btn-floating m-1" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Add to favorites">
          <i class="fa-solid fa-heart"></i>
        </a>
        <a class="btn btn-outline-light btn-floating m-1" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Add to watched">
          <i class="fa-solid fa-eye"></i>
        </a>
        <a class="btn btn-outline-light btn-floating m-1" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Add to watchlist">
          <i class="fa-solid fa-ticket"></i>
        </a>
        <a class="btn btn-outline-light btn-floating m-1" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Recommend to a friend">
          <i class="fa-regular fa-share-from-square"></i>
        </a>
      </section>
    </div>
  </div>
</div>

<h2 class="mt-5">Ratings</h2>
<div class="container bg-dark text-white p-4">
  <div class="d-flex justify-content-between">
    <div>
      <p class="d-inline ps-4"> {% if movie_datab.rating %}MSDB rating: {{ movie_datab.rating|floatformat }} - Based on {{ movie_datab.review_count }} rating{% if movie_datab.review_count > 1 %}s{%endif%} {% else %}Not yet rated by MSDB users{% endif %}</p>
    </div>
    {% if user %}
      <div class="pe-4">
        {% if user and not review%}
          <button id="add-review" class="btn btn-outline-light">Add review</button>
        {% endif %}
        {% if user and review %}
        <button id="edit-review" class="btn btn-outline-light">Edit review</button>
        {% endif %}
      </div>
    {% else %}
      <a href="{% url 'account_login' %}"class="btn btn-outline-light" data-bs-toggle="tooltip" data-bs-placement="top" title="Sign In to be able to add reviews">Add review</a>
    {% endif %}
  </div>
  {% include "review/reviews.html" with reviews=reviews review=review%}
</div>

<div class="modal fade" tabindex="-1" role="dialog" id="modal">
  <div class="modal-dialog" role="document">
    <div class="modal-content"></div>
  </div>
</div>

{% endblock content %}

{% block inline_javascript %}
<script>
  const user = "{{user}}"
  const review = "{{review}}"

  if (user != "None" && review == "None") {
    document.addEventListener('DOMContentLoaded', (e) => {
      modalForm(document.getElementById('add-review'), {
        formURL: "{% url 'add_review' movie_datab.id %}"
      })
    });
  }
  if (user && review) {
    document.addEventListener('DOMContentLoaded', (e) => {
      modalForm(document.getElementById('edit-review'), {
        formURL: "{% url 'edit_review' movie_datab.id %}"
      })
    });
  }
</script>
{% endblock inline_javascript %}
